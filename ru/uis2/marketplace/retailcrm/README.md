## Интеграция с RetailCRM <br />


Решение позволяет передавать в наш кабинет данные по сделкам, для дальнейшего построения Сквозной аналитики, а также интегрировать функционал телефонии и передавать данные по звонкам и текстовым коммуникациям в RetailCRM. <br /> 

<br />
<br />
<br />
<br />
<br />
<br />

## Функционал интеграции <br />  

<details>
 <summary style="font-weight:bold;"> Подробнее </summary> <br />


Данные передаваемые по звонкам:  <br />

- всплывающие уведомления о входящих звонках;
- звонок в один клик из RetailCRM;
- сохранение истории и записей звонков в RetailCRM;
- синхронизация сотрудников;
- возможность гибкой настройки создания клиентов, заказов и задач по звонкам. <br />


Данные передаваемые по текстовым коммуникациям:  <br />

- возможность гибкой настройки создания клиентов, заказов и задач по обращениям;
- передача дополнительных полей в клиента или заказ;
- встройка нашего виджета РМО в кабинет RetailCRM при подключении соответствующего расширения. <br />


Данные получаемые по сделкам:    <br />
- сделки: сумма сделки, статус, магазин, к которому относится сделка и тд; 
- воронка продаж и ее этапы;
- клиенты;
- ответственный менеджер.   <br />


</details> 

<br />
<br />
<br />
<br />
<br />
<br />
<br />


## Подключение учетной записи <br />

<details>
 <summary style="font-weight:bold;"> Шаги по подключению </summary> <br />

Для авторизации в RetailCRM необходимо в ЛК UIS: <br />  

- нажать "Авторизация";
- если ранеее добавляли учетные данные RetailCRM, то выбрать их из списка; <br /> 
- если нет, то нажать "Добавить учетные данные" и заполнить значения:
  - название; <br />
  - URL (домен RetailCRM ) в формате YOURDOMAIN.retailcrm.ru , часть 'YOURDOMAIN' у каждого клиента уникальна;
  - API key - ключ API RetailCRM, Настройки - > Интеграция → Ключи доступа к API -> Добавить  <br />
  Создаем новый ключ, с доступом ко всем магазинам и методам. Добавляем данный ключ в настройки интеграции.  <br />

![image](retailcrm_auth.gif)  <br />

      
После добавления учетных данных на странице появятся Параметры интеграции.  <br />

</details> 

<br />
<br />
<br />
<br />
<br />
<br />
<br />



## Подключение телефонии   <br />

<details>
 <summary style="font-weight:bold;"> Шаги по подключению </summary> <br />
  
1. **Сотрудники** 
<br /> 
<br />

**Варианты сопоставления сотрудников** - выберите один из двух вариантов: <br /> 

- **Синхронизация** - настройка позволяет автоматически импортировать выбранных сотрудников из RetailCRM в UIS.<br /> 
Связь сотрудника в UIS с сотрудником из RetailCRM происходит по e-mail. При прожатии будут выведены дополнительные настройки: <br /> 
   - список сотрудников из RetailCRM. Необходимо выбрать тех сотрудников, которых требуется создать в UIS.
   - кнопка"Синхронизировать", для принудительной синхронизации сотрудников. По умолчанию синхронизация происходит каждые 2 часа.
<br />
  
- **Соответствие** - настройка позволяет вручную указать соответствие сотрудников из RetailCRM и UIS.  <br />
<br /> 
<br />

2. **Ответственный по умолчанию** - данный сотрудник будет назначен ответственным на создаваемые  сущности, если выбрана соотвествующая настройка .<br />

3. **Фильтровать по виртуальным номерам** - выберите настройку, если требуется  фильтрация по виртуальным номерам (в случае подключения нескольких интеграций). <br />
При прожатии будет выведена дополнительная настройка с выбором виртуальных номеров. <br />

4. **Обработка звонков**  <br />
   
4.1.  **Создавать клиент при звонке** - настройка позволяет создавать клиент в разделе "Клиенты" при начале разговора. <br />

При её выборе выводится дополнительная настройка выбора ответственного сотрудника. <br /> 
**Назначать ответственного на** - выберите кого назначать ответственным за успешный звонок от нового клиента. <br />

4.2. **Создавать задачу по пропущенному звонку** - гибкая настройка создания задач по пропущенным звонкам:
- выберите требуемый тип звонка;
- укажите ответственного сотрудника;
- измените шаблон названия, при необходимости (через "+" можно добавить требуемые параметры);
- укажите срок исполнения задачи в часах (к времени завершения звонка прибавится данное время).
<br />

4.3. Выберите настройку **Включить переадресацию на персонального менеджера**, если необходима переадресация на персонального менеджера из CRM.  <br />

4.4. **Передавать дополнительные поля** - настройка позволяет передавать дополнительные поля в клиента. <br />
При её выборе выводятся дополнительные настройки соответствия полей в RetailCRM и UIS.
Добавьте все требуемые значения. Если требуется передавать значение в поля не только при первичных звонках (при создании клиента), но и при повторных, выберите настройку "Обновлять всегда".  <br />

4.5. **Внешние номера магазинов** - укажите соответствие магазинов из RetailCRM и их внешних номеров (виртуальные номера). <br />

4.6. **Номер для звонка по клику** - номер, который определяется у клиента при звонке от сотрудника, у которого нет зарегистрированной SIP-линии. <br /> 

4.7. **Переопредeлять АОН для исходящих звонков** - выберите настройку, если требуется для всех исходящих звонков по клику отображать клиенту только выбранный номер в параметре "Номер для звонка по клику". <br /> 

5. Активируйте интеграцию. <br />

6. Нажмите сохранить. <br />

При подключении интеграции в нашем ЛК, автоматически подключается приложение в Маркетплейсе в RetailCRM.<br />
Для проверки работы интеграции на тестовых звонках проверьте работу пунктов указаных в **"Данные передаваемые по звонкам"**. <br />

</details> 

<br />
<br />
<br />
<br />
<br />
<br />
<br />

## Подключение текстовых коммуникаций   <br />

<details>
 <summary style="font-weight:bold;"> Шаги по подключению </summary> <br />

1. **Ответственный по умолчанию** - данный сотрудник будет назначен ответственным на все создаваемые сущности, если выбрана соотвествующая настройка. <br />

2. **Передача заявок** <br />

2.1 **Передавать заявки** - выберите настройку, если требуется передавать данные по заявкам в RetailCRM.
При её выборе выводятся дополнительные настройки вариантов передачи заявок. <br />

2.2. **Условия фильтрации** - задайте условия, если требуется фильтровать заявки по сайтам и/или типам.<br />

2.3. **Создавать клиента** - настройка позволяет создавать клиента в разделе "Клиенты" по заявкам. <br />

2.4. **Создавать заказ** - настройка позволяет создавать заказ в разделе "Заказы" по заявкам. <br />
При её выборе выводятся дополнительные настройки создания заказа по типу заявки и ответственному сотруднику. <br />

3. **Передача чатов**  <br />

3.1. **Передавать чаты** - выберите настройку, если требуется передавать данные по чатам в RetailCRM.
При её выборе выводятся дополнительные настройки вариантов передачи чатов.  <br />

3.2. **Условия фильтрации** - задайте условия, если требуется фильтровать заявки по сайтам, каналам и/или тегам.  <br />

3.3. **Создавать клиента** - настройка позволяет создавать клиента в разделе "Клиенты" по чатам. <br />

При её выборе выводятся дополнительные настройки:
- Выберите на какое событие создавать клиента: начало чата, завершение чата, простановка тега.
- При выборе простановки тега дополнительно выводится список тегов. 
<br />
 
3.4. **Создавать заказ** - настройка позволяет создавать заказ в разделе "Заказы" по чатам. <br />

При её выборе выводятся дополнительные настройки:
- Выберите на какое событие создавать заказ: начало чата, завершение чата, простановка тега.
- Выберите кого указывать ответственным за заказ.

3.5. **Создавать задачу по потерянному чату** - гибкая настройка создания задач по потерянным чатам:
- укажите ответственного сотрудника;
- измените шаблон названия, при необходимости (через "+" можно добавить требуемые параметры);
- укажите срок исполнения задачи в часах (к времени завершения чата прибавится данное время).
<br />

4. **Передавать дополнительные поля** - настройка позволяет передавать дополнительные поля в клиента и заказ. <br />
При её выборе выводятся дополнительные настройки выбора сущности в RetailCRM и соответствия их полей в RetailCRM и UIS.
Добавьте все требуемые значения. Если требуется передавать значение в поля не только при первичных чатах (при создании клиента), но и при повторных, выберите настройку "Обновлять всегда".  <br />


5. **Сопоставление сайтов с магазинами** - укажите соответствие магазинов из RetailCRM и сайта из UIS. <br />

6. Активируйте интеграцию. <br />

7. Нажмите сохранить. <br />

При подключении интеграции в нашем ЛК, автоматически подключается приложение в Маркетплейсе в RetailCRM.<br />
Для проверки работы интеграции на тестовых звонках проверьте работу пунктов указаных в **"Данные передаваемые по текстовым коммуникациям"**. <br />

</details>  

<br />
<br />
<br />
<br />
<br />
<br />
<br />
 

## Подключение передачи сделок   <br />


<details>
 <summary style="font-weight:bold;"> Шаги по подключению </summary> <br />


1. Активируйте интеграцию. <br />

2. **Настройте Триггер в RetailCRM** <br />

<details>
  <summary style="font-weight:bold;"> Подробнее </summary> <br />

Автоматизация → Триггеры →  Добавить триггер <br />
Заполните настройки триггера:

- название ;
- добавляем событие 'Изменение заказа ': 
  - обязательно указываем в условиях:  "Новый заказ" или  "Изменение статуса заказа с Любой на Любой" или "Заказ оплачен "Да";
  - в действие добавляем "Выполнить HTTP-запрос"  , в нем заполняем настройки :
     - Адрес  - Webhook url из настроек интеграции;
     - HTTP метод - GET;
     - Передавать параметры - в строке запроса; 
        - Параметр: orderId 
        - Значение: {{ order.id }} <br />

![image](retail_trigger_3.gif)

</details> 

<br />
 
3. Проставьте требуемые настройки: <br />
- **Дефолтная воронка** — при прожатии все сделки будут передаваться в 1 воронку по умолчанию. В противном случае по каждом магазину будет создана отдельная воронка. <br />
- **Учитывать стоимость доставки** — при прожатии в сумму сделки будет включена стоимость доставки. <br />
- **Передавать дополнительные поля** — при прожатии будет выведен список дополнительных полей из RetailCRM. выберите те, которые требуется передавать в наши отчеты в связке со сделками.

4. Нажмите сохранить. <br />


После подключения интеграции сделки будут попадать в  Сырые данные -> Сделки.  <br />
Для проверки корректности работы интеграции создайте тестовую сделку в RetailCRM.

</details> 
