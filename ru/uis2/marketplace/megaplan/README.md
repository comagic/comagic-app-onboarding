## Интеграция с Megaplan <br />  

Решение позволяет передавать в наш кабинет данные по сделкам, для дальнейшего построения Сквозной аналитики, а также интегрировать функционал телефонии и передавать данные по звонкам и текстовым коммуникациям в Megaplan. <br />  

## Функционал интеграции <br />  

<details>
 <summary style="font-weight:bold;"> Подробнее </summary> <br />

Данные передаваемые по звонкам:  <br />

- всплывающая карточка контакта при звонке сотруднику;
- прослушивание записанных разговоров прямо в личном кабинете Megaplan;
- сохранение всей истории коммуникаций с клиентом в его карточке;
- автоматическое соединение клиента с его персональным менеджером;
- исходящий звонок по клику или звонок из виджета;
- автоматическое создание контакта при любом звонке;
- создание задачи на потерянные входящие и неуспешные исходящие звонки;
- возможность создавать коммуникации по выбранным направлениям звонков;
- синхронизация с режимом “не беспокоить” веб-телефона Megaplan;
- переадресация на ответственного из CRM, при настройки соответственного сценария в ЛК <br />

Данные передаваемые по текстовым коммуникациям:  <br />

- возможность гибкой настройки создания контактов, дел, процессов по обращениям;
- передача текста заявок или переписки в контакт и процесс;
- встройка нашего виджета РМО в кабинет Megaplan при подключении соответствующего расширения. <br />


 Данные получаемые по сделкам:    <br />
- сделки: сумма сделки, валюту, товары/услуги и тд;  
- воронка продаж и ее этапы;  
- контакты;  
- ответственный менеджер.  <br />  

</details> 
<br />
<br />


## Подключение учетной записи <br />

<details>
 <summary style="font-weight:bold;"> Шаги по подключению </summary> <br />

Для авторизации в Megaplan необходимо в ЛК UIS: <br />  

- нажать "Авторизация";
- если ранеее добавляли учетные данные Megaplan, то выбрать их из списка, если нет, то нажать "Добавить учетные данные";
- заполнить значения:
  - название;
  - логин(username) и пароль(password) от Megaplan;
  - домен Megaplan в формате https://mp36845.megaplan.ru , часть 'mp36845' будет у каждого клиента уникальной.
    
После добавления учетных данных на странице появятся Параметры интеграции. 



</details> 

<br />
<br />
<br />
<br />
<br />
<br />
<br />  

## Синхронизация сотрудников <br />
<br /> 

<details>
 <summary style="font-weight:bold;"> Шаги по подключению </summary> <br />
 
Свитч активации **Синхронизация сотрудников** прожат по умолчанию для корректной работы всех компонентов интеграции. Выключение может привести к потери работоспособности.<br /> 
<br /> 

1. **Синхронизировать всех сотрудников** - выберите настройку, если требуется импортировать всех сотрудников из Мегаплан в UIS. При выключенной настройке становится доступным список сотрудников для синхронизации.   <br />

2. Выберите конкретных сотрудников в настройке **Сотрудники для синхронизации**, если требуется синхронизировать не всех сотрудников из Мегаплан.  <br /> 

3. Нажмите кнопку **Синхронизировать сотрудников** для ручной синхронизации сотрудников. <br />
При первом подключении интеграции обязательное действие.  <br />


5. Нажмите **Сохранить**.   <br />

**Важно!**  Если в Мегаплан появился новый сотрудник, которого надо синхронизировать в UIS, то это необходимо сделать вручную по нажатию кнопки "Синхронизировать", после чего сотрудник станет доступен для выбора в настройке.

</details> 

## Телефония   <br />
<br /> 

<details>
 <summary style="font-weight:bold;"> Шаги по подключению </summary> <br />

Для передачи данных по звонкам из UIS в Planfix прожмите свитч активации интеграции "Телефония".  <br /> 

<br />

## Основное <br /> 
<br />
  
 1. Синхронизация настройки телефонии </summary> <br />
   
- В **Megaplan** заполните настройку телефонии: <br /> 

a. Подключите приложение UIS 
  -  Под пользователем, который входит в группу «Директора» или «Админы», зайдите в личный кабинет Megaplan. 
  -  В аккаунте выберите раздел «Маркет приложений» - > «Магазин интеграций». 
  - Найдите приложение «UIS телефония и мессенджеры» в категории «Телефония» и установите его.
  - После установки необходимо авторизоваться в личном кабинете UIS под администратором.
  - Далее вас переадресует на маркетплейс UIS.  <br />

![image](telefon.png) 
<br />

b. Подключите расширение 

  -  В Megaplan необходимо указать для каждого пользователя Megaplan внутренний номер виртуальной АТС UIS. 
     - Для этого откройте интерфейс Megaplan, перейдите в раздел “Настройки”, откройте вкладку “Интеграция”, в меню слева выберите пункт “Телефония”. 
     - Установите “Подключение к телефонии по API” и затем нажмите “Настройки телефонии”. 
     - Перейдите на вкладку на “Пользователи”.
     - Добавьте всех пользователей, использующих телефонию. Для каждого из них укажите внутренние номера АТС из раздела "Сотрудники".  <br />

     ![image](megaplan_telephony.gif) 

     **Важно:** если сотрудник не будет указан в данном разделе, то функционал поднятия карточки звонка и передача информации по нему не будет доступен.  <br /> 
     - Нажимаем сохранить.  <br />
 
- Нажмите кнопку "Синхронизировать настройки телефонии из Megaplan". <br />

**Обработка звонков**  

1. **Включить переадресацию на персонального менеджера** - активируйте, если необходима переадресация на персонального менеджера из CRM. Для работы необходим сценарий с данной операцией. <br />  

2. **Фильтровать звонки** - данная настройка необходима для фильтрации звонков по определенным условиям. Если не использовать фильтр, то по всем звонкам будет создаваться сущность в CRM. При включении настройки станет доступно для выбора две поднастройки: "Фильтр входящих" и "Фильтр исходящих" звонков.Условия можно прописывать через операторы И/ИЛИ. Если фильтр настроен, то он будет помечен зеленой точкой в верхнем правом углу. Если вы нажали на чекбокс "Фильтровать звонки", но не выбрали никакую настройку в выпадающем списке - передаем все звонки.<br />  

**Звонки по клику из CRM**  

1. **Номер для звонка по клику** - выберите, какой номер будет отражаться при звонке по клику. <br />  

2. **Всегда отображать номер** - сли включить опцию, то правила отображения номера сотрудника будут игнорироваться и всегда будет отображаться выбранный номер. <br />    

**Клиент**  

1. **При первичном входящем звонке создавать** - выберите, на какого сотрудника будет создаваться клиент, при первичном входящем звонке. <br /> 

2. **При первичном исходящем звонке создавать** - выберите, на какого сотрудника будет создаваться клиент, при первичном исходящем звонке. <br />   

**Дело**  

1. **При успешном входящем звонке создавать** - выберите, на какого сотрудника будет создаваться дело, при успешном входящем звонке. <br />     

2. **При потеряном входящем звонке создавать** - выберите, на какого сотрудника будет создаваться дело, при потеряном входящем звонке. <br />  

3. **При успешном исходящем звонке создавать** - выберите, на какого сотрудника будет создаваться дело, при успешном исходящем звонке. <br />  

4. **При потеряном исходящем звонке создавать** - выберите, на какого сотрудника будет создаваться дело, при потеряном исходящем звонке. <br />  

**Коммуникация**

1. **Статус коммуникации при успешном входящем звонке** - выберите, какой статус присвоить созданной коммуникации при успешном входящем звонке. <br />   

2. **Статус коммуникации при потерянном входящем звонке** - выберите, какой статус присвоить созданной коммуникации при потеряном входящем звонке. <br />  

3. **Статус коммуникации при успешном исходящем звонке** - выберите, какой статус присвоить созданной коммуникации при успешном исходящем звонке. <br />

4. **Статус коммуникации при неуспешном исходящем звонке** - выберите, какой статус присвоить созданной коммуникации при неуспешном исходящем звонке. <br />

5. **Длинетльность коммуникации** - укажите продолжительность созданных коммуникаций в минутах. 


**Процесс** 

1. **При успешном входящем звонке создавать** - выберите сехму процесса и отвественного сотрудника, для процесса по успешному входящему звонку. <br />  

2. **При потерянном входящем звонке создавать** - выберите сехму процесса и отвественного сотрудника, для процесса по потеряному входящему звонку. <br />   

3. **При успешном исходящем звонке создавать** - выберите сехму процесса и отвественного сотрудника, для процесса по успешному исходящему звонку. <br />   

4. **При неуспешном исходящем звонке создавать** - выберите сехму процесса и отвественного сотрудника, для процесса по неуспешному исходящему звонку. <br />   

   
## Шаблоны <br /> 
<br />  

В этом разделе вы можете настроить шаблон названий клиентов, которые будут автоматически создаваться в Мегаплан при поступлении входящих или исходящих звонков, а так же отдельно для потерянных звонков.

1. Нажав на кнопку плюса, можно выбрать, какое значение переменной установить в шаблон наименования сущности. <br />   

2. Кнопка с иконкой (глаза) дает возможность сделать предпросмотр наименования которое будет отображено в создаваемой сущности. <br />   

3. Кнопка с иконкой (закругленой стрелочки) возвращает шаблон поля к последнему сохраненному значению. <br /> 
<br />  


## Ответственные <br />  
<br /> 

Настройка позволяет управлять назначением ответственных сотрудников за сущности в зависимости от условий. <br />


1. Задайте ответственного по умолчанию - это обязательное поле. <br />

2. Для добавлении условия назначения ответственного нажмите кнопку "Добавить" в основных условиях. <br />
- Выберите сотрудника из выпадающего списка. 
- Далее выберите условия или группы условий для определения правил, по которым будут проставляться ответственные в создаваемых сущностях по обращениям.
- Нажмите "Сохранить". <br /> 


<br /> 
<br />   


## Дополнительные поля <br />  
<br /> 

Настройка позволяет передавать дополнительные поля в Клиента.

1. Сопоставьте для каждой сущности дополнительные поля из Мегаплан и UIS. 

2. При необходимости обновлять поля при каждом обращении прожмите **Обновлять всегда**.

3. После добавления сопоставления всех требуемых дополнительных полей - нажмите "Сохранить".<br />


<br /> 

</details> 

<br />
<br />
<br />
<br />


Для проверки работы интеграции на тестовых звонках проверьте работы пунктов указаных в "Данные передаваемые по звонкам".
Если после всех настроек звонки в Megaplan не появляются, проверьте, совпадают ли внутренние номера сотрудников в разделе “Телефония” в Megaplan и нашем Личном кабинете.
   
 </details> 


<br />
<br />
<br />
<br />
<br />
<br />
<br />

## Текстовые коммуникации <br />
<br />    

<details>
 <summary style="font-weight:bold;"> Шаги по подключению </summary> <br />
Для передачи данных по чатам и заявкам из UIS в Мегплан прожмите свитч активации интеграции "Текстовые коммуникации".  <br /> 

<br />

## Основное <br /> 
<br />  

**Заявки** 

1. **Передавать первичные обращения** - прожимте для активации передачи первичных обращений в Мегаплан. <br />

2. **Создавать клиента для первичных обращений** - прожмите для создания клиента по первичной заявке. <br />  

3. **Для первичных обращений создавать** - выберите, какие дополнительные сущности создавать к клиенту по первичной заявке.<br />  

4. **Создавать на сотрудника** - выберите, на какого сотрудника создавать сущности. <br />   

5. **Передавать повторные обращения** - прожмите для активации передачи повторных обращений в Мегаплан. <br />

6. **Для повторных обращений создавать** - выберите, какие дополнительные сущности создавать к клиенту по повторной заявке.<br />    

7. **Создавать на сотрудника** - выберите, на какого сотрудника создавать сущности. <br />   

8. **Условия фильтрации** - данная настройка необходима для фильтрации заявок по определенным условиям. Если не использовать фильтр, то по всем заявкам будет создаваться сущность в CRM. Условия можно прописывать через операторы И/ИЛИ. Если фильтр настроен, то он будет помечен зеленой точкой в верхнем правом углу. <br />  

**Чаты**

1. **Передавать первичные обращения** - прожимте для активации передачи первичных обращений в Мегаплан. <br />

2. **Создавать клиента** - прожмите для создания клиента по первичнному чату. <br />  

3. **Для первичных обращений создавать** - выберите, какие дополнительные сущности создавать к клиенту по первичному чату.<br />  

4. **Создавать на сотрудника** - выберите, на какого сотрудника создавать сущности. <br />   

5. **Передавать повторные обращения** - прожмите для активации передачи повторных обращений в Мегаплан. <br />

6. **Для повторных обращений создавать** - выберите, какие дополнительные сущности создавать к клиенту по повторному чату.<br />    

7. **Создавать на сотрудника** - выберите, на какого сотрудника создавать сущности. <br /> 

8. **Создаем Клиента / Дело / Процесс** - выберите, на какой момент чата необходимо создавать сущности. <br />

9. **Условия фильтрации** - данная настройка необходима для фильтрации чатов по определенным условиям. Если не использовать фильтр, то по всем чатам будет создаваться сущность в CRM. Условия можно прописывать через операторы И/ИЛИ. Если фильтр настроен, то он будет помечен зеленой точкой в верхнем правом углу. <br /> 


10. **Передавать чаты без контактных данных** - включите если необходимо передаваться чаты от посетителей, у которых отсутствует номер телефона. При каждом новом чате с посетителем без контактных данных будет создаваться новый контакт и задача, что может привести к дублям в Мегаплан.

## Шаблоны <br /> 
<br />  

В этом разделе вы можете настроить шаблон названий клиентов, которые будут автоматически создаваться в Мегаплан при поступлении чатов и заявок. 

1. Нажав на кнопку плюса, можно выбрать, какое значение переменной установить в шаблон наименования сущности. <br />   

2. Кнопка с иконкой (глаза) дает возможность сделать предпросмотр наименования которое будет отображено в создаваемой сущности. <br />   

3. Кнопка с иконкой (закругленой стрелочки) возвращает шаблон поля к последнему сохраненному значению. <br /> 
<br />  


## Ответственные <br />  
<br /> 

Настройка позволяет управлять назначением ответственных сотрудников за сущности в зависимости от условий. <br />


1. Задайте ответственного по умолчанию - это обязательное поле. <br />

2. Для добавлении условия назначения ответственного нажмите кнопку "Добавить" в основных условиях. <br />
- Выберите сотрудника из выпадающего списка. 
- Далее выберите условия или группы условий для определения правил, по которым будут проставляться ответственные в создаваемых сущностях по обращениям.
- Нажмите "Сохранить". <br /> 


<br /> 
<br />   


## Дополнительные поля <br />  
<br /> 

Настройка позволяет передавать дополнительные поля в Клиента.

1. Сопоставьте для каждой сущности дополнительные поля из Мегаплан и UIS. 

2. При необходимости обновлять поля при каждом обращении прожмите **Обновлять всегда**.

3. После добавления сопоставления всех требуемых дополнительных полей - нажмите "Сохранить".<br />


<br /> 

Для проверки работы интеграции на тестовых обращениях проверьте работы пунктов указаных в "Данные передаваемые по текстовым коммуникациям". <br />

 </details> 

<br />
<br />
<br />
<br />
<br />
<br />
<br />

 ## Передача сделок   <br />


<details>
 <summary style="font-weight:bold;"> Шаги по подключению </summary> <br />


1. Активируйте интеграцию. <br />  
2. Создайте приложение в Megaplan на Webhook url сервиса UIS из настроек.  <br />  

![image](megaplan_app.gif) 
<br />  

3. **Анализ воронок продаж в отчетах** - прожимте в случае если вам необходимо получать сделки, только по определенным воронкам. <br /> 

4. **Воронки** - выберите воронки необходимые для анализа. <br /> 

5.  Нажмите сохранить <br />  

После подключения интеграции сделки будут попадать в  Сырые данные -> Сделки.  <br />  
Для проверки корректности работы интеграции создайте тестовую сделку в Megaplan.

</details> 
