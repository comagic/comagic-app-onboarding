### Интеграция с Yclients  <br />

**Ценность**  <br /> 

Решение позволяет получать заявки оставленные клиентами в форме Онлайн-виджета , загружать в наш кабинет записи(сделки) из Yclients, а также передавать данные по звонкам из нашего ЛК в Yclients. <br />  
 
**Какие данные передаются**    <br />

Данные получаемые по заякам:   <br />

- контактные данные (имя,телефон,email);  
- дату и время создания; 
- данные сессии (рекламную кампанию, источник, UTM-метки и тд);  
- в случае отсутствия сессии, дефолтную РК или источник.<br />


Данные получаемые по сделкам:    <br />
- сделки: сумма сделки, название, даты изменения и тд; 
- воронка продаж и ее этапы;
- контакты;
- ответственный менеджер;
- дополнительные поля.  <br />

Данные передаваемые по звонкам:  <br />

- всплывающие уведомления о входящих звонках;
- сохранение истории и записей звонков в Yclients. <br />

<br />
<br />
<br />

## Подключение передачи заявок с Онлайн-виджета.  <br />

**Необходимые компоненты для работы интеграции**  <br />  
- Загрузка оффлайн-заявок из внешней системы.  <br />

<details>
 <summary style="font-weight:bold;"> Шаги по подключению </summary> <br />

1. Прожмите переключатель "Yclients передача заявок c Онлайн-виджета", для активации интеграции. <br />
2. Выполните настройку интеграции. <br />

- **Настройте Webhook в Yclients** <br />

<details>
 <summary style="font-weight:bold;"> Подробнее </summary> <br />

Отправка хука настраивается в Yclients через создание собственного приложения, инструкция по созданию находится [по ссылке](https://support.yclients.com/67-68-202?_ga=2.235690817.1118622726.1689663799-975683808.1687778856) .  

- В поле «Адрес, на который отправлять уведомления» укажите url из параметра "Webhook URL".
- В настройке хука в разделе **"Отправлять события по сущностям"** выбираем **"Событие по записям", "Событие по клиентам"**.
  
![image](yc_hook.jpg)  

**Важно**: если у клиента несколько филиалов, для каждого необходимо события хука настраивать отдельно, так как настройки для каждого филиала располагаются отдельно друг от друга.  
![image](yc_hook.jpg)  

 
</details> 
<br />

- **Рекламная кампания/источник** — необходимо выбрать какую сущность использовать для обращений без сессии. По умолчанию выбрана Рекламная кампания (маркер не прожат), при прожатии маркера выбирается Источник. <br />
- В зависимости от положения переключателя "Рекламная кампания/источник" выводится либо список рекламных кампаний из личного кабинета клиента, либо список источников и сайтов. Необходимо указать какую **Рекламную кампанию/источник и сайт** используем в случае отсутствия сессии. <br />

3. Нажмите сохранить. <br />
4. После сохранения будет выведен скрипт, который необходимо установить на сайт в соответствие с описанием в настройках.<br />
![image](yc_f_vkl.gif)   
Данный скрипт устанавливаем на всех страницах сайта, где расположен виджет Yclients, а так же требуется добавить наш скрипт и стандартный код вставки в саму форму в YClients (инъекция скрипта).  <br />

**Важно**: <br />
   - Инъекция скрипта доступна для всех клиентов в старом дизайне. В новом дизайне Yclients  добавляет данную функцию по запросу.  
   ![image](yc_f1.jpg) ![image](yc_f2.jpg)   
   - Если клиент на сайт добавляет не виджет Yclients (кнопку), а отдельную ссылку на лендинг, то в этой ссылке необходимо добавить  class="yclick" <br />
   
   **Пример:** <br />
 
  <Alert backgroundColor="#c3e8d7">
    
   a class="yclick" href="https://n822081.yclients.com/" target="_blank">Открыть новую вкладку</a>

   где "https://n822081.yclients.com/" - это домен страницы на которой стоит ваш виджет.
   
 </Alert>   <br />
  
После подключения интеграции сделки будут попадать в  Сырые данные -> Обращения и цели.  <br />
Для проверки корректности работы интеграции оставьте тестовую запись в Онлайн-виджете Yclients.

</details> 

<br />
<br />
<br />
<br />
<br />
<br />
<br />
  
## Подключение передачи сделок   <br />

**Необходимые кампоненты для работы интеграции**   <br />
- Сквозная аналитика.  <br />

<details>
 <summary style="font-weight:bold;"> Шаги по подключению </summary> <br />

 
1. Прожмите переключатель "Yclients передача сделок", для активации интеграции. <br />
2. Выполните настройку интеграции. <br />

- **Настройте Webhook в Yclients** <br />

<details>
 <summary style="font-weight:bold;"> Подробнее </summary> <br />

Отправка хука настраивается в Yclients через создание собственного приложения, инструкция по созданию находится [по ссылке](https://support.yclients.com/67-68-202?_ga=2.235690817.1118622726.1689663799-975683808.1687778856) .  

- В поле «Адрес, на который отправлять уведомления» укажите url из параметра "Webhook URL".
- В настройке хука в разделе **"Отправлять события по сущностям"** выбираем **"Событие по записям", "Событие по клиентам"**.
  
![image](yc_hook.jpg)  

**Важно**: если у клиента несколько филиалов, для каждого необходимо события хука настраивать отдельно, так как настройки для каждого филиала располагаются отдельно друг от друга.  
![image](yc_hook.jpg)  


</details> 
<br />

- **Авторизация в Yclients** <br />

<details>
 <summary style="font-weight:bold;"> Подробнее </summary> <br />
 
   - В поле "Credential" нажимаем "Add Credential".
   - В открывшемся окне вводим название, логин от кабинета Yclients (username), пароль от кабинета Yclients(password).
   - Нажимаем клавишу сохранить. 
    ![image](yc_d_vkl.gif)

</details> 
<br />

После подключения интеграции сделки будут попадать в  Сырые данные -> Сделки.  <br />
Для проверки корректности работы интеграции создайте тестовую сделку в Yclients.


</details> 
<br />
<br />
<br />
<br />
<br />
<br />
<br />

## Подключение телефонии   <br />

<details>
 <summary style="font-weight:bold;"> Шаги по подключению </summary> <br />

1. Прожмите переключатель "Yclients телефония", для активации интеграции. <br />
2. **Сеть** - укажите название сети, с которой подключаете интеграцию. С каждой сетью интеграция подключается отдельно, так как User token в Yclients формируется под каждую сеть.
3. Добавьте **User token** из Yclients в поле **Авторизация**.  <br />
User token можно получить в Телефония -> Интеграция, поле "Токен".

![image](yclients_1.jpg)
<br /> 

4. **Список виртуальных номеров** - укажите виртуальные номера, по которым необходимо отображать данные по звонкам в Yclients в указанной сети. <br />
5. **Способ маршрутизации** - выберите, какая сущность будет использоваться для маршрутизации, SIP или внутренний номер.
6. Нажмите **сохранить**. <br />
7. В кабинете Yclients, после проведенных настроек, появятся дополнительные разделы в блоке Сеть –> Телефония: <br />  
Маршрутизация, Маршруты и Звонки (1), а статус интеграции изменится на Интеграция подключена (2)
![image](yclients_2.jpg)
<br />

8. В Yclients перейдите в раздел **Маршруты** и выстроите маршрут, по которому будет идти звонок. <br />
Маршрут по умолчанию всего один – Маршрут для всех пользователей. <br />
Настройка маршрута по умолчанию – сохранять историю звонков по маршруту в Истории сети.<br />

![image](Yclients_marshroot1.png) <br /> 

Кликните, чтобы открыть настройки. <br />

![image](Yclients_marshroot2.png) <br />

При такой настройке всплывающие уведомления о звонках работать не будут, а звонки будут видны только в истории звонков сети.  <br />
**Измените настройку** на ту, которая вам подходит: <br />
  - история звонков сети и всех салонов – всплывающее окно о звонке будет появляться во всех филиалах сети, звонок будет виден во всех филиалах в разделе Обзор – Звонки. 
  - история звонков сети и уведомленных салонов – всплывающее окно о звонке будет появляться в том филиале/филиалах, которые будут выбраны в этом маршруте. <br />
  
9. После настройки маршрута свяжите его с номером телефона/идентификатором абонента телефонии, sip, на который поступают звонки. <br />
Для этого перейдите в раздел **Маршрутизация**.
 ![image](Yclients_marshrootizacia1.png) <br />
Укажите номер телефона своей компании без плюса, скобок, дефисов, пробелов и других символов и сохраните. <br />
Настройка в  Yclients завершена. <br />
<br />

Для проверки работы интеграции на тестовых звонках проверьте работы пунктов указаных в **"Данные передаваемые по звонкам"**. <br />
Если после всех настроек звонки в Yclients не появляются, проверьте, совпадают ли номера телефонов в маршрутизации Yclients и нашем Личном кабинете.


</details> 
